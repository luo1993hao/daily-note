### 基础原理篇

操作系统在计算机运行过程中扮演的角色

-  魔术师
   - 丑陋变美好
   - 没有变为有
   - 少变多
-  管理者

#### 操作系统导论

- 恰当的思维模式
- 人造科学特点
  - 具有相对性（没有对错）
  - 从对人类活动的主观判断力（堆，队列）
  - 依赖与人的主观判断力
  - 符合人的直觉（同步机制与男女谈恋爱）
    自然存在 /神造具有相反的四个特性
- 操作系统是
  - 操作系统是介于计算机和应用软件之间的一个软件系统
  - 让计算机变得好用
  - 掌握计算机上所有事情的软件系统
- 为什么要学操作系统
  - 抽象，缓存，并发，触类旁通
  - 有趣？  

### 进程原理篇

#### 进程

- 人类希望的并发从理想变为了现实
- ![image-20200616112932993](/Users/haoyu.luo/Library/Application Support/typora-user-images/image-20200616112932993.png)
- 进程与地址空间研究的主要内容是如何让多个进程空间共享一个物理内存。具体来说，就是高效、安全地让 所有进程共享这片物理内存。
- 公平与效率就成了进程管理中永恒的主题
- 进程的缺点（所以发明了线程）
  - 进程只能在一个时间做一个事情
  - 依赖阻塞
- 进程管理的根本手段是进程表

#### 进程调度

- 程序使用cpu的模式
  - 计算密集型
  - Io密集型
  - 平衡
- 算法
  - 先来先服务调度算法
  - 时间片轮转算法（改善短程序的响应时间）
  - 短任务优先算法
  - 优先调度算法
  - 混合调度算法
  - 实时调度算法
    - EDF调度算法（最早截止的任务先做）
- 调度异常之优先级倒挂

#### 进程通信

- 进程对白
  - 管道
  - 记名管道
  - 套接字（双方都创建一个套接字，一个监听，一个连接）
- 进程电报：信号
- 进程拥抱：共享内存
- 信件发送：消息队列

### 线程原理篇

进程自身是串形的，每个进 程有自己的独立空间，协作困难

![image-20200616185943352](/Users/haoyu.luo/Library/Application Support/typora-user-images/image-20200616185943352.png)

#### 线程

- 线程就是我们为了让一个进程 能够同时干多件事情而发明的“分身术”。

- ![image-20200616190555560](/Users/haoyu.luo/Library/Application Support/typora-user-images/image-20200616190555560.png)

- 线程模型实现

  - 内核态线程实现
    - 编程简单
    - 效率低
  - 用户态编程实现
    - 编程困难（自己写执行系统作为调度器）

- 现代操作系统线程模型

  - 用户态的执行系统负 责进程内部线程在非阻塞时的切换;内核态的操作系统负责阻塞线程的切换

    

#### 线程同步

目的就是不管线程之间的执行如何穿插，其运行结果都是正确的

- 锁解决了同步问题，但带来的是循环等待，我们不满意。为了消除循环等待，我们发明了 睡觉与叫醒。但睡觉与叫醒又带来了死锁，因此，我们发明了信号量。 

- 管程：管程的中心思想是运行一个在管程里面睡觉的线程

  - 管程最大的问题是对编译器的依赖。因为我们需要编译器将需要的同步原语加在管程的开始和结尾

    

- 栅栏

#### 死锁

定义：如果有一组线程，每个线程都在等待一个事件的发生，而这个事件只 能由该组线程里面的另一线程发出，则称这组线程发生了死锁  

##### 死锁的应对

  - 顺其自然，不予理睬

    - Windows、Linux和其他商业操作系统都没有采取死锁防止措施，这就是为什么你的电脑经常死机的原因

- 先礼后兵:死锁检测与修复（不可行）

  - 利用矩阵算法检查死锁

- 先发制人:死锁的动态避免

- 斩草除根:死锁的静态防止

  - 消除死锁的必要条件

    - 消除资源独占条件

    - 消除保持和请求条件

    - 消除非抢占条件

    - 消除循环等待条件

      

用人口控制来作 比喻，就是不控制婴儿的出生;允许生育，但想办法处理出生的婴儿;不准结婚来静态防止生育和可以结婚 但不许生育来进行动态避免。



#### 锁的实现

- 以中断启用与禁止来实现锁（繁忙等待）
- 以测试与设置指令来实现锁（繁忙等待）
- 以非繁忙等待、中断启用与禁止来实现锁
- 以最少繁忙等待、测试与设置来实现锁

### 内存原理篇

#### 基本内存管理

- 目标

  - 地址保护:一个程序不能访问另一个程序地址空间。

  - 地址独立:程序发出的地址应与物理主存地址无关。

    

- 虚拟内存的概念

- 多道编程下内存管理

  - 固定分区

  - 非固定分区

    ![image-20200618113944729](/Users/haoyu.luo/Library/Application Support/typora-user-images/image-20200618113944729.png)

- 动态地址翻译的优点
  - 灵活，可以将 程序随便加载到任何地方
  - 它是实施地址保护的“不二法 门”
  - 它使虚拟内存的概念得以实现